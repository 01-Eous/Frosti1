---
title: "AC 自动机学习笔记"
description: "其实 AC 自动机和 AC 没有什么关系，也可以是 WA 自动机，RE 自动机。"
pubDate: "Apr 04 2025"
categories:
  - tech
tags:
  - 学习笔记
---

## 前言

前置知识：

- 字典树（必须会）
- KMP（了解即可）

## 正题

想了解自动机的请前往 [OI-wiki](https://oi-wiki.org/string/automaton/)

知周所众，AC 自动机就是“字典树上 KMP”。我们看 KMP 的主要流程是什么。KMP 的流程就是往后匹配，如果在 $i + 1$ 的位置失配了，就跳到 $nxt_i$ 的位置上去继续匹配。KMP 相对暴力的区别就在于失配的处理方式。

考虑多模式串如何匹配。首先想暴力。我们把所有的模式串塞到一个字典树里。如果失配了，也就是在字典树上没有这个方向的儿子了，那么就该重新来过，从字典树的根开始重新匹配，时间复杂度 $O(n^2)$。

如何优化？效仿 KMP。在 KMP 中的 $nxt_i$ 表示前 $i$ 个字符组成的字串的最长相等的前后缀的长度。那么失配就可以直接跳到 $nxt_i$。\
同理，我们在字典树上记录一个 $fail$，表示在这个节点失配了该跳到哪里。因为字典树上的每个点都代表一个字符串，所以 $fail$ 的准确定义是：$fail$ 节点表示的字符串是当前节点表示的字符串的一段后缀，且 $fail$ 是诸多满足这种条件的节点中深度最大的。匹配时如果失配了，那么就不往下走，反而跳到 $fail$ 然后继续匹配。

考虑如何处理。我们发现，如果 $u$ 